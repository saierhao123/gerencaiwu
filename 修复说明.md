# 个人记账系统修复说明

## 修复的问题

### 1. 微信账单字段映射问题
**问题描述**: 微信账单中的"交易类型"和"当前状态"字段没有正确映射到程序中的"交易分类"和"交易状态"字段，导致这些字段显示为nan。

**修复方案**: 
- 将微信的"交易类型"字段映射为"交易分类"
- 将微信的"当前状态"字段映射为"交易状态"
- 确保所有必要字段都存在

**修改文件**: `bill_parser.py` 中的 `parse_wechat_bill` 函数

### 2. 支付宝收/付款方式映射问题
**问题描述**: 支付宝账单中的"收/付款方式"字段没有正确映射到程序中的"支付方式"字段。

**修复方案**: 
- 将支付宝的"收/付款方式"字段映射为"支付方式"
- 将"交易订单号"映射为"交易单号"
- 将"商家订单号"映射为"商户单号"

**修改文件**: `bill_parser.py` 中的 `parse_alipay_bill` 函数

### 3. 新增调整后分类标准
**功能描述**: 根据配置文件中的分类规则，自动为每条交易记录添加"调整后分类"和"调整后子分类"字段。

**实现方案**:
- 在 `bill_parser.py` 中添加 `_apply_classification_rules` 方法
- 根据收/支类型选择对应的分类规则
- 通过关键词匹配自动分类
- 如果没有匹配到规则，使用原始分类信息

**配置文件**: `config.json` 中的"分类规则"部分

## 修改的文件

### 1. bill_parser.py
- 修复微信账单字段映射
- 修复支付宝账单字段映射
- 添加分类规则应用功能
- 确保所有必要字段都存在

### 2. main.py
- 更新表格列数和表头
- 添加"调整后分类"和"调整后子分类"列
- 更新筛选功能使用调整后分类
- 更新数据显示逻辑

## 新增字段

1. **调整后分类**: 根据配置文件规则自动分类的主分类
2. **调整后子分类**: 根据配置文件规则自动分类的子分类

## 测试结果

- 成功解析微信账单: 35条记录
- 成功解析支付宝账单: 124条记录
- 所有关键字段正确映射
- 分类规则正确应用
- 主程序正常运行

## 使用方法

1. 将账单文件放在 `zhangdang` 文件夹中
2. 运行 `python main.py` 启动程序
3. 点击"开始处理"按钮处理账单
4. 在"交易明细"标签页查看所有交易记录
5. 在"统计结果"标签页查看分类统计

## 注意事项

1. 确保 `config.json` 配置文件存在且格式正确
2. 微信账单文件应为Excel格式(.xlsx)
3. 支付宝账单文件应为CSV格式(.csv)
4. 程序会自动识别账单类型并应用相应的解析规则
